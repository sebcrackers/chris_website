<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simon Fraser University Greek Student Association</title>

  <!-- Roboto font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="icon" href="https://i.ibb.co/8L9frjLX/Logo-variations.png" type="image/png">
  <style>
    :root{
      --blue: #0b67c2;
      --navy: #054b8b;
      --muted: #b8c2d6;
      --bg: #4d5d84;
      --glass: rgba(77,93,132,0.85);
      --card-shadow: 0 6px 18px rgba(0,0,0,0.15);
      --max-width: 1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Roboto, system-ui, -apple-system, "Segoe UI", "Helvetica Neue", Arial;
      color:#e0ddd5;
      background:var(--bg);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.45;
    }

    /* Layout wrapper */
    .container{max-width:var(--max-width);margin:0 auto;padding:0 20px;}

    /* NAV */
    header{
      position:fixed; width: 100%;top:0;z-index:10000;
      backdrop-filter: blur(6px);
      background: linear-gradient(180deg, rgba(77,93,132,0.9), rgba(77,93,132,0.7));
      border-bottom:1px solid rgba(255,255,255,0.1);
    }
    .nav{
      display:flex;align-items:center;justify-content:space-between;height:72px;
      gap:16px;
    }
    .logo{
      display:flex;align-items:center;gap:10px;font-weight:700;color:#fff;
      text-decoration:none;
    }
    .logo .mark{
      width:44px;height:44px;border-radius:8px;
      background:linear-gradient(180deg,#4d5d84,#3a4869);
      display:flex;align-items:center;justify-content:center;
      border:2px solid var(--blue);
      font-weight:700;color:#fff;
      font-size:18px;
    }

    nav ul{display:flex;align-items:center;gap:12px;list-style:none;margin:0;padding:0}
    nav a{color:#fff;text-decoration:none;padding:8px 10px;border-radius:8px;font-weight:500}
    nav a:hover{background:rgba(255,255,255,0.1)}

    /* Dropdown */
    .dropdown{position:relative}
    .dropbtn{display:flex;gap:6px;align-items:center;cursor:pointer}
    .dropdown-menu{
      position:absolute;left:0;top:calc(100% + 8px);min-width:180px;
      background:#4d5d84;border:1px solid rgba(255,255,255,0.1);box-shadow:var(--card-shadow);
      border-radius:10px;padding:8px;display:none;flex-direction:column;z-index:80;
    }
    .dropdown-menu a{padding:8px 12px;border-radius:6px;color:#fff;font-weight:500}
    .dropdown-menu a:hover{background:rgba(255,255,255,0.1)}

    /* CTA / icons */
    .nav-right{display:flex;align-items:center;gap:12px}
    .btn{
      background:#e0ddd5;
      color:#4d5d84;padding:10px 14px;border-radius:10px;border:none;font-weight:600;cursor:pointer;
      box-shadow:0 6px 18px rgba(0,0,0,0.15)
    }
    .icon-btn{background:transparent;border:none;cursor:pointer;padding:6px;border-radius:8px}
    .icon-btn svg{display:block}

    /* HERO */
    .hero{
      position:relative;height:56vh;min-height:380px;display:flex;align-items:center;justify-content:center;
      margin-bottom:40px;overflow:hidden;
    }
    .hero::before{
      content:"";
      position:absolute;inset:0;
      background-image: url('https://lh3.google.com/u/0/d/1qmLZXlSDqu1IiMhz9BVPCt3lcr8ZxAJ9=w1867-h983-iv2?auditContext=forDisplay');
      background-size:cover;background-position:center;
      background-attachment: fixed;
      filter: brightness(0.85);
      transform: scale(1.05);
      z-index:0;
    }
    .hero .overlay{
      position:relative;z-index:2;text-align:center;color:white;padding:20px;
      max-width:900px;
    }
    .hero h1{font-size:clamp(20px,4vw,38px);margin:0 0 12px;font-weight:700;letter-spacing:0.2px;text-shadow:0 6px 18px rgba(0,0,0,0.25)}
    .hero p{margin:0 0 18px;font-weight:500}
    .hero .hero-cta{display:inline-block;background:rgba(255,255,255,0.12);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,0.18);color:white;padding:10px 16px;border-radius:10px;font-weight:600}

    /* Sections */
    section{padding:48px 0;border-top:1px solid rgba(255,255,255,0.05)}
    /* Stretch section full width */
.section-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0; /* remove spacing between text and image */
  align-items: stretch;
  max-width: 100%;  /* stretch full width */
  margin: 0;         /* no centering */
  padding: 0;        /* remove side padding */
}

/* Text box full height with no rounded edges */
.section-grid .text {
  background: var(--glass); /* optional background so text is readable */
  padding: 40px;
  border-radius: 0; /* remove rounded edges */
  display: flex;
  flex-direction: column;
  justify-content: center;
}

/* Image full height with no rounded edges */
.img-card {
  width: 100%;
  height: auto;
  min-height: 350px;
  border-radius: 0; /* remove rounded edges */
  background-size: cover;
  background-position: center;
  border: none;
  box-shadow: none;
}

    /* blog cards */
    .posts-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;max-width:var(--max-width);margin:0 auto;padding:0 20px}
    .post{background:#4d5d84;border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.1);box-shadow:var(--card-shadow);display:flex;flex-direction:column;gap:8px}
    .post .thumb{height:140px;border-radius:8px;background:#3a4869;background-size:cover;background-position:center;border:1px solid rgba(255,255,255,0.08)}
    .post h3{margin:6px 0 0;font-size:16px;color:#fff}
    .post p{margin:0;color:var(--muted);font-size:14px;flex:1}

    .see-more{display:block;margin:18px auto 0;text-align:center}

    /* Footer */
    footer{padding:18px 0;text-align:center;color:var(--muted);font-size:14px}
    footer a{color:var(--muted);text-decoration:underline;cursor:pointer}

    /* NEW: Background peek-through above Latest News */
    #home-blog {
      position: relative;
      z-index: 1;
    }

    .background-peek {
      position: absolute;
      top: -60px; /* Adjust this value to control how much shows above the section */
      left: 0;
      bottom: 300px;
      width: 100%;
      height: 300px; /* Height of the peek area */
      background-image: url('https://lh3.google.com/u/0/d/1iaCY2leDelKpxbrgApH3__nxFo0ANDau=w1867-h983-iv4?auditContext=forDisplay');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      filter: brightness(0.85);
      z-index: -1;
      mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,1) 60%, rgba(0,0,0,0) 100%);
      -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,1) 60%, rgba(0,0,0,0) 100%);
    }

    /* Responsive */
    @media (max-width:900px){
      .section-grid{grid-template-columns:1fr;gap:18px}
      .posts-grid{grid-template-columns:1fr;max-width:640px}
      .nav{padding:0 8px}
      
      /* Adjust peek height on mobile */
      .background-peek {
        height: 80px;
        top: -40px;
      }
    }

    /* Admin / forms */
    .page{max-width:var(--max-width);margin:24px auto;padding:24px;background:var(--glass);border-radius:12px;border:1px solid rgba(255,255,255,0.1)}
    .form-row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    label{display:block;font-weight:600;margin-bottom:6px;color:#fff}
    input[type="text"], input[type="password"], textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.1); background:rgba(255,255,255,0.1); color:#fff}
    textarea{min-height:140px;resize:vertical}
    .small{font-size:13px;color:var(--muted)}

    .admin-post{display:flex;gap:12px;align-items:flex-start;background:#4d5d84;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);box-shadow:var(--card-shadow)}
    .admin-post img{width:100px;height:70px;object-fit:cover;border-radius:6px}
    .admin-actions{margin-left:auto;display:flex;gap:8px}

    .muted{color:var(--muted)}
    .hidden{display:none}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a class="logo" href="#home" id="brand">
        <img src="https://i.ibb.co/8L9frjLX/Logo-variations.png" style="width:80px; margin-left: -120px; padding: 5px;">
      </a>

      <nav>
        <ul>
          <li class="dropdown" id="aboutDropdown">
            <div class="dropbtn"><a style="cursor:pointer">About Us ▾</a></div>
            <div class="dropdown-menu" id="aboutMenu">
              <a href="#who" class="menu-link">Who We Are</a>
              <a href="#board" class="menu-link">Board</a>
              <a href="#constitution" class="menu-link">Constitution</a>
            </div>
          </li>
          
          <li class="dropdown" id="commDropdown">
            <div class="dropbtn"><a style="cursor:pointer">Communications ▾</a></div>
            <div class="dropdown-menu" id="commMenu">
              <a href="#home-blog" class="menu-link">Latest News</a>
              <a href="#coming-soon" class="menu-link">Contact Us</a>
              <a href="#coming-soon" class="menu-link">Instagram</a>
            </div>
          </li>          
          <li><a href="#blog" id="newsLink">News</a></li>
        </ul>
      </nav>

      <div class="nav-right">
        <button class="btn" id="membershipBtn" style="border-radius: 0;">Become a Member</button>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <main id="mainContent" role="main">
    <section class="hero" id="home">
      <div class="overlay">
        <h1>Simon Fraser University:</br> Greek Student Association</h1>
        <img src="https://lh3.google.com/u/0/d/1byEKX0F_rcZn6eYNQ4q1eqrK2cn4j8uz=w1867-h983-iv1?auditContext=prefetch" style="height: 80px;">
      </div>
    </section>

    <!-- Who We Are -->
    <section id="who">
      <div class="section-grid">
        <div class="text">
          <h2>Who We Are</h2>
          <p>Learn more about Simon Fraser University Greek Student Association.</p>
          <button class="btn" style="width: 30%; background-color:#4d5d84; color:#e0ddd5; border-color: #e0ddd5; border: 1px;">Learn More</button>
        </div>
        <div class="img-card" style="background-image:url('https://lh3.google.com/u/0/d/16OWXtTruF7FOwrfTTzSHcHhADm4nnJbj=w1867-h983-iv2?auditContext=forDisplay')"></div>
      </div>
    </section>

    <!-- Board -->
    <section id="board">
      <div class="section-grid">
        <div class="img-card" style="background-image:url('https://lh3.google.com/u/0/d/1gMFNKRUUeydZobsZwRqCWlFZsJWsNB2y=w1867-h983-iv2?auditContext=forDisplay')"></div>
        <div class="text">
          <h2>Board</h2>
          <p>Our board is a group of elected students responsible for programming, membership, and governance. We operate transparently and welcome involvement from all members of the student body.</p>
          <button class="btn" style="width: 30%; background-color:#4d5d84; color:#e0ddd5; border-color: #e0ddd5; border: 1px;">Learn More</button>
        </div>
      </div>
    </section>

    <!-- Constitution -->
    <section id="constitution" style="margin-bottom: 50px;">
      <div class="section-grid">
        <div class="text">
          <h2>Constitution</h2>
          <p>Our constitution outlines membership rights, board responsibilities, and the processes that ensure accountability and fairness across all activities. Contact us for a full copy or to request amendments.</p>
          <button class="btn" style="width: 30%; background-color:#4d5d84; color:#e0ddd5; border-color: #e0ddd5; border: 1px;">Learn More</button>
        </div>
        <div class="img-card" style="background-image:url('https://lh3.google.com/u/0/d/1I3gxFNKY2QXtyAqoW52hMHv5jKW-NAX2=w1867-h983-iv2?auditContext=forDisplay')"></div>
      </div>
    </section>

    <!-- Blog / News -->
    <section id="home-blog">
      <!-- Background peek-through element -->
      <div class="background-peek"></div>
      
      <div class="container">
        <h2 style="text-align:center;color: #e0ddd5;margin-bottom:18px">LATEST NEWS</h2>
        <div id="postsWrap" class="posts-grid" aria-live="polite"></div>
        <div class="see-more">
          <button class="btn" id="seeMoreBtn">See More</button>
        </div>
      </div>
    </section>

    <!-- COMING SOON page area -->
    <section id="coming-soon" class="hidden page">
      <h2>COMING SOON</h2>
      <p class="muted">This feature (Instagram / Membership) is coming soon. Check back later.</p>
    </section>

    <!-- Blog page (all posts) -->
    <section id="blog" class="hidden page">
      <h2>Blog & News</h2>
      <div id="allPosts" style="display:flex;flex-direction:column;gap:12px;margin-top:12px"></div>
    </section>

    <!-- Login page -->
    <section id="login" class="hidden page">
      <h2>Admin Login</h2>
      <div style="max-width:540px">
        <div style="margin-bottom:12px"><label>Username</label><input type="text" id="loginUser" placeholder="Username"></div>
        <div style="margin-bottom:12px"><label>Password</label><input type="password" id="loginPass" placeholder="Password"></div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="loginBtn">Login</button>
          <button class="icon-btn" id="backHome" style="color: #e0ddd5;">Back</button>
        </div>
      </div>
    </section>

    <!-- Admin Dashboard -->
    <section id="admin" class="hidden page">
      <h2>Admin Dashboard</h2>
      <div style="display:flex;gap:12px;align-items:center;margin-bottom:14px">
        <div style="flex:1">
          <label>New Post Headline</label><input type="text" id="postHead" placeholder="Headline">
        </div>
        <div style="flex:1">
          <label>Image (optional)</label><input type="file" id="postImage" accept="image/*">
        </div>
      </div>
      <div style="margin-bottom:12px">
        <label>Body</label>
        <textarea id="postBody" placeholder="Body text..."></textarea>
      </div>
      <div style="display:flex;gap:8px;margin-bottom:18px">
        <button class="btn" id="createPost">Create Post</button>
        <button class="icon-btn" id="logoutBtn">Logout</button>
      </div>

      <h3 style="margin-top:8px">Existing Posts</h3>
      <div id="adminPosts" style="display:flex;flex-direction:column;gap:10px;margin-top:8px"></div>
    </section>

  </main>

  <footer>
    <div class="container">
      <div style="display:flex;justify-content:center;gap:12px;align-items:center;flex-wrap:wrap">
        <span class="small muted">© Simon Fraser University Greek Student Association</span>
        <a id="adminLoginFooter" style="cursor:pointer">Admin Login</a>
      </div>
    </div>
  </footer>

  <script>
    /*******************************
     * Single-file site behaviour
     *******************************/

    // Simple SPA: show/hide sections by hash
    const sections = {
      'home': document.getElementById('home'),
      'who': document.getElementById('who'),
      'board': document.getElementById('board'),
      'constitution': document.getElementById('constitution'),
      'coming-soon': document.getElementById('coming-soon'),
      'blog': document.getElementById('blog'),
      'login': document.getElementById('login'),
      'admin': document.getElementById('admin'),
      'home-blog': document.getElementById('home-blog')
    };

    function hideAllPages(){
      // hide pages with class 'page' and extras like blog
      document.querySelectorAll('.page').forEach(e=>e.classList.add('hidden'));
      // always show core sections (home, who, board, constitution) unless navigating to another full page
      document.querySelectorAll('section').forEach(s=>{
        s.style.display = '';
      });
    }

    function route(){
      const h = location.hash.replace('#','') || 'home';
      // handle full pages: blog, coming-soon, login, admin
      if(h==='blog' || h==='coming-soon' || h==='login' || h==='admin'){
        // hide main content sections except header/footer
        document.querySelectorAll('main > section').forEach(s=>{
          s.style.display = 'none';
        });
        const page = document.getElementById(h);
        if(page) page.style.display = 'block';
        // show header and footer are sticky
      } else if (h.startsWith('post:')){
        const id = h.split(':')[1];
        showPostFull(id);
      } else {
        // home / anchor sections - show all
        document.querySelectorAll('main > section').forEach(s=>{
          s.style.display = '';
        });
        // scroll to anchor if exists
        const el = document.getElementById(h);
        if(el){
          setTimeout(()=>el.scrollIntoView({behavior:'smooth',block:'start'}),50);
        }
      }
    }

    window.addEventListener('hashchange', route);
    window.addEventListener('load', () => {
      initDropdown();
      route();
      renderRecentPosts();
      renderAllPosts();
      renderAdminPosts();
      
      // Add event listener for admin login footer link
      document.getElementById('adminLoginFooter').addEventListener('click', ()=> {
        location.hash='login';
      });
    });

    // Dropdown toggle
    function initDropdown(){
  document.querySelectorAll('.dropdown').forEach(drop => {
    const btn = drop.querySelector('.dropbtn');
    const menu = drop.querySelector('.dropdown-menu');

    btn.addEventListener('click', (e)=>{
      e.stopPropagation();
      // close all others first
      document.querySelectorAll('.dropdown-menu').forEach(m=> m.style.display='none');
      // toggle this one
      menu.style.display = (menu.style.display==='flex'?'none':'flex');
    });
  });

  // Close if click outside
  document.addEventListener('click', ()=>{
    document.querySelectorAll('.dropdown-menu').forEach(m=> m.style.display='none');
  });
}


    // Coming soon links
    document.getElementById('membershipBtn').addEventListener('click', ()=> location.hash='coming-soon');
    document.getElementById('seeMoreBtn').addEventListener('click', ()=> location.hash='blog');
    document.getElementById('backHome').addEventListener('click', ()=> location.hash='home');

    // --- Posts storage (localStorage) ---
    const STORAGE_KEY = 'sfu_gsa_posts_v1';

    function loadPosts(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) {
        // initialize with 3 sample posts
        const sample = [
          {
            id: genId(),
            headline: 'Welcome Week Social',
            body: 'Join us for a welcome week social on the Student Centre lawn. Food, music, and meet & greet with the board.',
            img: 'https://images.unsplash.com/photo-1530629013299-6cb9b7b0b2e3?q=80&w=1400&auto=format&fit=crop&ixlib=rb-4.0.3&s=b8b9c6d7f0bbf5f9a7e6d1c3b2a4c8d9',
            ts: Date.now() - 1000*60*60*24*3
          },
          {
            id: genId(),
            headline: 'Philanthropy Drive',
            body: 'This semester our philanthropy drive supports campus food security initiatives. Donations welcome.',
            img: 'https://images.unsplash.com/photo-1529257414771-1960c2d8a28b?q=80&w=1400&auto=format&fit=crop&ixlib=rb-4.0.3&s=0b3e8b9c9d1c3f6a7e4a2b1c9f8e5d6a',
            ts: Date.now() - 1000*60*60*24*7
          },
          {
            id: genId(),
            headline: 'Board Nominations Open',
            body: 'Nominations for board positions are open. If you are passionate about community leadership, apply today.',
            img: '',
            ts: Date.now() - 1000*60*60*24*10
          }
        ];
        localStorage.setItem(STORAGE_KEY, JSON.stringify(sample));
        return sample;
      }
      try{
        return JSON.parse(raw) || [];
      }catch(e){ return []; }
    }

    function savePosts(posts){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(posts));
    }

    function genId(){ return 'p_' + Math.random().toString(36).slice(2,9); }

    // render 3 most recent posts on homepage
    function renderRecentPosts(){
      const postsWrap = document.getElementById('postsWrap');
      postsWrap.innerHTML = '';
      const posts = loadPosts().sort((a,b)=>b.ts - a.ts).slice(0,3);
      posts.forEach(p=>{
        const el = document.createElement('article');
        el.className = 'post';
        el.innerHTML = `
          <div class="thumb" style="background-image:url('${p.img || 'https://images.unsplash.com/photo-1503264116251-35a269479413?q=80&w=1400&auto=format&fit=crop&ixlib=rb-4.0.3&s=9a7b5bc3b2b0c6f6605a6a7f0818ec5b'}')"></div>
          <h3>${escapeHtml(p.headline)}</h3>
          <p>${escapeHtml(truncate(p.body||'',120))}</p>
          <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center">
            <small class="small muted">${timeAgo(p.ts)}</small>
            <a href="#post:${p.id}" style="text-decoration:none;color:#e0ddd5;font-weight:600">Read</a>
          </div>
        `;
        postsWrap.appendChild(el);
      });
    }

    // render all posts in blog page
    function renderAllPosts(){
      const all = document.getElementById('allPosts');
      if(!all) return;
      all.innerHTML = '';
      const posts = loadPosts().sort((a,b)=>b.ts - a.ts);
      if(posts.length===0){
        all.innerHTML = '<p class="muted">No posts yet.</p>';
        return;
      }
      posts.forEach(p=>{
        const node = document.createElement('div');
        node.className = 'admin-post';
        node.innerHTML = `
          <div style="flex:1">
            <h3 style="margin:0">${escapeHtml(p.headline)}</h3>
            <p class="small muted" style="margin:6px 0">${timeAgo(p.ts)}</p>
            <p style="margin:0">${escapeHtml(truncate(p.body,300))}</p>
            <a href="#post:${p.id}" style="display:inline-block;margin-top:8px;color:#e0ddd5;font-weight:600">Read full</a>
          </div>
          ${p.img?`<img src="${p.img}" alt="post image">`:'<div style="width:100px;height:70px;border-radius:6px;background:#3a4869;border:1px solid rgba(255,255,255,0.1)"></div>'}
        `;
        all.appendChild(node);
      });
    }

    // admin list
    function renderAdminPosts(){
      const wrap = document.getElementById('adminPosts');
      if(!wrap) return;
      wrap.innerHTML = '';
      const posts = loadPosts().sort((a,b)=>b.ts - a.ts);
      posts.forEach(p=>{
        const div = document.createElement('div');
        div.className = 'admin-post';
        div.innerHTML = `
          ${p.img?`<img src="${p.img}" alt="">`:'<div style="width:100px;height:70px;border-radius:6px;background:#3a4869;border:1px solid rgba(255,255,255,0.1)"></div>'}
          <div style="flex:1">
            <h4 style="margin:0">${escapeHtml(p.headline)}</h4>
            <p class="small muted" style="margin:6px 0">${timeAgo(p.ts)}</p>
            <p style="margin:0">${escapeHtml(truncate(p.body,220))}</p>
          </div>
          <div class="admin-actions">
            <button class="btn" data-id="${p.id}" data-action="delete">Delete</button>
          </div>
        `;
        wrap.appendChild(div);
      });

      // attach delete handlers
      wrap.querySelectorAll('button[data-action="delete"]').forEach(btn=>{
        btn.addEventListener('click', ()=> {
          const id = btn.dataset.id;
          if(confirm('Delete this post?')) {
            const posts = loadPosts().filter(x=>x.id !== id);
            savePosts(posts);
            renderAdminPosts();
            renderAllPosts();
            renderRecentPosts();
          }
        });
      });
    }

    // Create post - admin
    document.getElementById('createPost').addEventListener('click', async ()=>{
      const head = document.getElementById('postHead').value.trim();
      const body = document.getElementById('postBody').value.trim();
      const file = document.getElementById('postImage').files[0];
      if(!head || !body){
        alert('Headline and Body are required.');
        return;
      }
      let dataUrl = '';
      if(file){
        dataUrl = await readFileAsDataURL(file);
      }
      const posts = loadPosts();
      posts.push({id: genId(), headline: head, body: body, img: dataUrl, ts: Date.now()});
      savePosts(posts);
      document.getElementById('postHead').value='';
      document.getElementById('postBody').value='';
      document.getElementById('postImage').value='';
      renderAdminPosts();
      renderAllPosts();
      renderRecentPosts();
      alert('Post created.');
    });

    function readFileAsDataURL(file){
      return new Promise((res,rej)=>{
        const fr = new FileReader();
        fr.onload = ()=>res(fr.result);
        fr.onerror = rej;
        fr.readAsDataURL(file);
      });
    }

    // Login behaviour
    document.getElementById('loginBtn').addEventListener('click', () => {
      const user = document.getElementById('loginUser').value.trim();
      const pass = document.getElementById('loginPass').value.trim();

      if (user === "Manoia" && pass === "2025") {
        // ✅ Redirect to admin.html
        window.location.href = "admin.html";
      } else {
        alert("Invalid username or password");
      }
    });

    document.getElementById('logoutBtn').addEventListener('click', ()=> {
      sessionStorage.removeItem('gsa_admin');
      window.location.hash = 'index.html';
    });

    // show full post page (in a simple modal-like section)
    function showPostFull(id){
      const posts = loadPosts();
      const p = posts.find(x=>x.id===id);
      if(!p){ location.hash='home'; return; }
      // show a simple full-post modal in the blog page area
      // repurpose #blog section
      document.querySelectorAll('main > section').forEach(s=> s.style.display='none');
      const blogPage = document.getElementById('blog');
      blogPage.style.display = 'block';
      blogPage.innerHTML = `
        <div style="max-width:900px;margin:0 auto;padding:28px;background:var(--glass);border-radius:12px;border:1px solid rgba(255,255,255,0.1)">
          <h1 style="margin-top:0">${escapeHtml(p.headline)}</h1>
          <p class="small muted">${timeAgo(p.ts)}</p>
          ${p.img?`<img src="${p.img}" style="width:100%;max-height:420px;object-fit:cover;border-radius:8px;margin-bottom:12px">`:''}
          <p style="white-space:pre-wrap">${escapeHtml(p.body)}</p>
          <div style="margin-top:16px;display:flex;gap:8px"><button class="btn" id="backToBlog">Back</button><a href="#home" style="align-self:center;color:var(--muted)">Home</a></div>
        </div>
      `;
      document.getElementById('backToBlog').addEventListener('click', ()=> location.hash='blog');
    }

    // small utilities
    function truncate(str, n){
      if(!str) return '';
      return str.length>n? str.slice(0,n).trim() + '…' : str;
    }
    function timeAgo(ts){
      const s = Math.floor((Date.now()-ts)/1000);
      if(s < 60) return `${s}s ago`;
      const m = Math.floor(s/60); if(m<60) return `${m}m ago`;
      const h = Math.floor(m/60); if(h<24) return `${h}h ago`;
      const d = Math.floor(h/24); if(d<7) return `${d}d ago`;
      const date = new Date(ts);
      return date.toLocaleDateString();
    }
    function escapeHtml(text){
      if(!text) return '';
      return text.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;');
    }

    // show admin page only if logged in
    window.addEventListener('hashchange', ()=>{
      if(location.hash.replace('#','') === 'admin'){
        if(!sessionStorage.getItem('gsa_admin')){
          alert('Please login as admin first.');
          location.hash='login';
          return;
        }
      }
    });

    // when admin page loads, ensure posts rendered
    // small observe
    new MutationObserver(()=>{
      if(location.hash.replace('#','') === 'admin'){
        renderAdminPosts();
      }
    }).observe(document.getElementById('admin'), {childList:true, subtree:true});

    // ensure recent/all posts rerender on storage change (useful across tabs)
    window.addEventListener('storage', (e)=> {
      if(e.key === STORAGE_KEY){
        renderRecentPosts();
        renderAllPosts();
        renderAdminPosts();
      }
    });

    // initial render hook
    // call again to ensure admin visibility
    renderRecentPosts();
    renderAllPosts();
    renderAdminPosts();

    // small accessibility: allow pressing Enter on dropdown button
    document.querySelectorAll('.dropbtn').forEach(btn=>{
      btn.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' || e.key === ' '){
          const menu = btn.parentElement.querySelector('.dropdown-menu');
          menu.style.display = (menu.style.display==='flex'?'none':'flex');
        }
      });
    });

  </script>
</body>
</html>
